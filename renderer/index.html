<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Gemini Image Downloader</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
  <div class="app-shell">
    <header class="hero">
      <div>
        <p class="eyebrow">Gemini Ops Suite</p>
        <h1>Automate prompt runs or download finished chats</h1>
        <p class="lede">Pick a workspace: start building the Prompt Automation Studio, or jump straight into the
          downloader that‚Äôs already battle-tested.</p>
      </div>
    </header>

    <main>
      <section class="view active" data-view="home">
        <div class="card-grid">
          <article class="card">
            <h2>Automation Studio</h2>
            <p>Design multi-script prompt runs with batching, numbering memory, and Gemini orchestration.</p>
            <button class="primary" data-nav="automation">Go to automation</button>
          </article>
          <article class="card">
            <h2>Image Downloader</h2>
            <p>Paste a Gemini share link and pull every rendered image + prompt metadata to disk.</p>
            <button class="primary" data-nav="downloader">Open downloader</button>
          </article>
        </div>
      </section>

      <section class="view full-bleed" data-view="automation">
        <div class="automation-shell">
          <aside class="automation-nav">
            <div class="nav-header">
              <p class="eyebrow">Automation Studio</p>
              <h2>Workflow builder</h2>
            </div>

            <div class="integrated-hubs">
              <p class="eyebrow">Integrated Hubs</p>
              <button class="ghost full" id="onenote-hub-btn">üìñ OneNote Sync</button>
            </div>

            <div class="add-section">
              <p class="eyebrow">Workflow builder</p>
              <label for="section-name-input">Create a group</label>
              <div class="input-row">
                <input type="text" id="section-name-input" placeholder="e.g. Master Scripts">
                <button id="add-section-btn" class="primary pill">+ Group</button>
              </div>
            </div>

            <div id="section-list" class="section-list">
              <p class="empty-state">No sections yet. Add one to start organizing scripts.</p>
            </div>

            <button class="ghost full" data-nav="home">‚Üê Back to menu</button>
          </aside>

          <div class="automation-content">
            <header class="automation-header">
              <div>
                <p class="eyebrow">Design surface</p>
                <h2>Manage batches, subsections, and scripts</h2>
                <p class="lede">Define each workflow section, add togglable subsections, and capture the script text per
                  item before wiring automation.</p>
              </div>
              <button class="ghost drawer-toggle" id="drawer-toggle-btn"><i data-lucide="menu"></i></button>
            </header>

            <section class="automation-actions">
              <div class="action-row">
                <div class="action-buttons">
                  <button class="primary" id="run-chatgpt-btn">Run ChatGPT</button>
                  <button class="primary outline" id="run-gemini-btn">Run Gemini</button>
                  <div class="aspect-ratio-selector">
                    <span class="selector-label">Aspect Ratio:</span>
                    <div class="aspect-ratio-buttons">
                      <button class="ratio-btn active" data-ratio="1:1" title="Square (1:1)">1:1</button>
                      <button class="ratio-btn" data-ratio="--ar 16:9" title="Landscape (16:9)">16:9</button>
                      <button class="ratio-btn" data-ratio="--ar 9:16" title="Portrait (9:16)">9:16</button>
                    </div>
                  </div>
                  <button class="ghost" id="chatgpt-responses-btn">üß† ChatGPT Responses</button>
                  <button class="ghost" id="view-output-btn">üìÑ Gemini Output</button>
                  <button class="ghost" id="open-extraction-btn">üîó Extract Chat</button>
                  <button class="ghost" id="engine-settings-btn">‚öôÔ∏è Engines</button>
                </div>
                <div class="automation-status">
                  <span>Status</span>
                  <div id="automation-status-pill" class="status-pill idle">Idle</div>
                </div>
                <div class="action-buttons right">
                  <button class="ghost danger" id="reset-output-btn">üßπ Reset ChatGPT Data</button>
                  <button class="ghost danger" id="reset-app-btn">‚èπÔ∏è Reset All</button>
                </div>
              </div>
              <div class="control-row">
                <div class="control-group">
                  <p class="eyebrow">ChatGPT controls</p>
                  <div class="control-buttons">
                    <button class="ghost" id="chatgpt-pause-btn">Pause</button>
                    <button class="ghost" id="chatgpt-resume-btn">Resume</button>
                    <button class="ghost" id="chatgpt-stop-btn">Stop</button>
                  </div>
                </div>
                <div class="control-group">
                  <p class="eyebrow">Gemini controls</p>
                  <div class="control-buttons">
                    <button class="ghost" id="gemini-pause-btn">Pause</button>
                    <button class="ghost" id="gemini-resume-btn">Resume</button>
                    <button class="ghost" id="gemini-stop-btn">Stop</button>
                  </div>
                </div>
              </div>
              <p class="action-note">
                Visible browser automation only. Stay signed into ChatGPT and Gemini in the windows that open so the
                runs can proceed without violating privacy policies.
              </p>
              <div class="action-log" id="automation-log">
                <div class="log-header">
                  <span>Automation Logs</span>
                  <button class="ghost log-toggle" id="log-toggle-btn" onclick="toggleLogSize()">‚ñ≤ Expand</button>
                </div>
                <div class="log-tabs">
                  <button class="log-tab active" data-tab="all" onclick="switchLogTab('all')">All Logs</button>
                  <button class="log-tab" data-tab="clean" onclick="switchLogTab('clean')">Clean Logs</button>
                </div>
                <div class="log-content">
                  <div class="log-view active" id="log-all">
                    <p class="empty-state">All logs will appear here.</p>
                  </div>
                  <div class="log-view" id="log-clean">
                    <p class="empty-state">Clean logs will appear here.</p>
                  </div>
                </div>
              </div>

              <div class="chat-extraction" id="chat-extraction" style="display: none;">
                <div class="extraction-header">
                  <div>
                    <p class="eyebrow">üéâ Batch completed!</p>
                    <h3>Extract prompts from ChatGPT chat</h3>
                    <p class="lede">Provide the ChatGPT chat link to extract all prompts and save them as new
                      subsections.</p>
                  </div>
                </div>

                <div class="extraction-form">
                  <div class="field">
                    <span>ChatGPT Chat URL <em>(required)</em></span>
                    <div class="url-row">
                      <input type="url" id="chat-url-input" placeholder="https://chatgpt.com/share/..." required />
                      <button type="button" id="extract-prompts-btn" class="primary">
                        <span class="btn-label">Extract Prompts</span>
                        <span class="btn-spinner"></span>
                      </button>
                    </div>
                  </div>

                  <div class="extraction-status" id="extraction-status">
                    <span>Status</span>
                    <div id="extraction-status-pill" class="status-pill idle">Ready</div>
                  </div>
                </div>
              </div>
            </section>

            <div class="script-editor" id="script-editor">
              <div class="editor-header">
                <div>
                  <p class="eyebrow" id="editor-breadcrumb">No script selected</p>
                  <h2 id="editor-title">Select a script to edit</h2>
                </div>
              </div>
              <textarea id="script-input" placeholder="Select a script slot to start writing..." disabled></textarea>
              <div class="editor-footer">
                <button class="ghost" id="clear-script-btn" disabled>Clear text</button>
                <span id="autosave-indicator">Waiting for input...</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="view" data-view="downloader">
        <div class="section-header">
          <div>
            <p class="eyebrow">Image Downloader</p>
            <h2>Extract everything from a Gemini share</h2>
            <p class="lede">Point us at a public chat, choose where to save, and let Playwright capture the assets.</p>
          </div>
          <button class="ghost" data-nav="home">Back to menu</button>
        </div>

        <form id="download-form">
          <div class="field">
            <span>Gemini Share URL <em>(required)</em></span>
            <input type="url" name="geminiUrl" placeholder="https://gemini.google.com/share/..." required />
          </div>

          <div class="field">
            <span>Custom output directory <em>(optional)</em></span>
            <div class="folder-row">
              <input type="text" name="outputDir" placeholder="Select a folder..." readonly id="output-dir" />
              <button type="button" id="browse-btn">Browse</button>
            </div>
          </div>

          <div class="field">
            <span>Output folder name <em>(default: gemini_images)</em></span>
            <input type="text" name="outputFolderName" placeholder="gemini_images" id="folder-name" />
          </div>

          <div class="actions">
            <button type="submit" id="start-btn">
              <span class="btn-label">Start Download</span>
              <span class="btn-spinner"></span>
            </button>
            <div id="status-pill" class="idle">Idle</div>
          </div>
        </form>

        <div id="log-output"></div>
      </section>
    </main>
  </div>

  <!-- Output Editor Modal -->
  <div id="output-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>üìÑ Gemini Prompts Output</h2>
        <div class="modal-actions">
          <button class="ghost" id="download-output-btn">üíæ Download</button>
          <button class="ghost" id="close-modal-btn">‚úï Close</button>
        </div>
      </div>
      <div class="modal-body">
        <textarea id="output-editor" placeholder="No prompts available yet..."></textarea>
      </div>
      <div class="modal-footer">
        <div class="footer-info">
          <span id="output-status">Ready</span>
          <span id="output-stats">0 prompts</span>
        </div>
        <div class="footer-actions">
          <button class="primary" id="save-output-btn">üíæ Save Changes</button>
          <button class="ghost" id="clear-output-btn">üóëÔ∏è Clear All</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ChatGPT Responses Modal -->
  <div id="responses-modal" class="modal" style="display: none;">
    <div class="modal-content large">
      <div class="modal-header">
        <h2>üß† ChatGPT Responses (Parsed)</h2>
        <div class="modal-actions">
          <button class="ghost" id="download-responses-btn">üíæ Download</button>
          <button class="ghost" id="close-responses-btn">‚úï Close</button>
        </div>
      </div>
      <div class="modal-body">
        <div class="prompt-review-header">
          <p class="lede">View and manage parsed prompts from the ChatGPT history log.</p>
          <div class="review-actions">
            <button class="ghost danger" id="clear-responses-btn">üóëÔ∏è Clear History</button>
          </div>
        </div>
        <div id="responses-card-list" class="prompt-card-list">
          <!-- Parsed response cards will be injected here -->
        </div>
      </div>
      <div class="modal-footer">
        <div class="footer-info">
          <span id="responses-status">Ready</span>
          <span id="responses-stats">0 prompts found</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Prompt Review Modal -->
  <div id="prompt-review-modal" class="modal" style="display: none;">
    <div class="modal-content large">
      <div class="modal-header">
        <h2>‚úèÔ∏è Review Extracted Prompts</h2>
        <div class="modal-actions">
          <button class="ghost" id="close-review-btn">‚úï Cancel</button>
        </div>
      </div>
      <div class="modal-body">
        <div class="prompt-review-header">
          <p class="lede">Review, edit, or delete prompts before saving them as subsections.</p>
          <div class="review-actions">
            <button class="ghost danger" id="delete-all-prompts-btn">üóëÔ∏è Delete All</button>
          </div>
        </div>
        <div id="prompt-card-list" class="prompt-card-list">
          <!-- Prompt cards will be injected here -->
        </div>
      </div>
      <div class="modal-footer">
        <div class="footer-info">
          <span id="review-status">Ready</span>
          <span id="review-stats">0 prompts</span>
        </div>
        <div class="footer-actions">
          <button class="primary" id="save-prompts-btn">üíæ Save Selected Prompts</button>
        </div>
      </div>
    </div>
  </div>

  <!-- OneNote Hub Modal -->
  <div id="onenote-modal" class="modal" style="display: none;">
    <div class="modal-content large glass-modal">
      <div class="modal-header">
        <div class="header-main">
          <div class="header-icon"><i data-lucide="book-open"></i></div>
          <div>
            <h2>OneNote Sync Hub</h2>
            <p class="lede">Browse notebooks and sections to import scripts.</p>
          </div>
        </div>
        <button class="ghost close-btn" id="close-onenote-btn"><i data-lucide="x"></i></button>
      </div>
      <div class="modal-body explorer-body">
        <div id="onenote-login-view" class="login-center">
          <div class="auth-card">
            <div class="auth-icon"><i data-lucide="lock"></i></div>
            <h3>Connect Microsoft Account</h3>
            <p>Enter your Azure Client ID to access your OneNote content.</p>
            <div class="field">
              <input type="text" id="onenote-client-id" placeholder="Azure Client ID...">
            </div>
            <button class="primary full" id="onenote-login-btn">
              <span>Sign in with Microsoft</span>
              <i data-lucide="chevron-right"></i>
            </button>
          </div>
        </div>

        <div id="onenote-pages-view" style="display: none;" class="explorer-view">
          <nav class="explorer-nav">
            <div class="nav-controls">
              <button class="ghost mini" id="onenote-back-btn" disabled>
                <i data-lucide="arrow-left"></i> Back
              </button>
              <div id="onenote-breadcrumbs" class="breadcrumbs">
                <span class="breadcrumb-item active">Notebooks</span>
              </div>
            </div>
            <div class="search-box">
              <i data-lucide="search"></i>
              <input type="text" id="onenote-search" placeholder="Search notes...">
            </div>
          </nav>

          <div id="onenote-content-list" class="explorer-list">
            <!-- Content will be injected here -->
          </div>

          <div class="explorer-footer">
            <div class="sync-status" id="onenote-status">Ready to sync</div>
            <button class="ghost mini" id="onenote-refresh-btn">
              <i data-lucide="rotate-cw"></i> Refresh
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Engine Settings Modal -->
  <div id="engine-modal" class="modal" style="display: none;">
    <div class="modal-content medium">
      <div class="modal-header">
        <h2>‚öôÔ∏è Parallel Engine Settings</h2>
        <button class="ghost" id="close-engine-btn">‚úï</button>
      </div>
      <div class="modal-body">
        <p class="lede">Manage multiple Gemini accounts for parallel processing. Each active engine runs in its own
          window.</p>
        <div id="engine-list" class="engine-list">
          <!-- Engines will be injected here -->
        </div>
        <button class="primary outline full" id="add-engine-btn">+ Add Gemini Account</button>
        <div class="engine-options">
          <div class="checkbox-row">
            <input type="checkbox" id="enable-parallel" checked>
            <label for="enable-parallel">Enable Parallel Load Balancing</label>
          </div>
          <p class="action-note">Parallel processing uses more RAM. We recommend max 3 accounts at once.</p>
        </div>
      </div>
    </div>
  </div>

  <script src="renderer.js"></script>
</body>

</html>